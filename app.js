function getData(){ return JSON.parse(localStorage.getItem('cp_requests')||'{"deposits":[],"withdraws":[]}');}
function saveData(d){ localStorage.setItem('cp_requests', JSON.stringify(d)); }
function addDeposit(amount, method, note){ const d=getData(); d.deposits.push({id:'dp_'+Date.now(),amount,method,note,status:'Requested',time:new Date().toLocaleString()}); saveData(d); }
function addWithdraw(amount,name,acc,ifsc){ const d=getData(); d.withdraws.push({id:'wd_'+Date.now(),amount,name,acc,ifsc,status:'Pending',time:new Date().toLocaleString()}); saveData(d); }
function renderRequests(){ const d=getData(); const wd=document.getElementById('wd_list'); const dp=document.getElementById('dp_list'); if(wd){ wd.innerHTML = d.withdraws.slice().reverse().map(r=>`<li class="p-2 border-b flex justify-between"><div><b>${r.name}</b> requested ₹${r.amount}</div><div class="text-sm text-orange-500">${r.status}</div></li>`).join('') || '<div class="text-gray-500">No withdraw requests</div>'; } if(dp){ dp.innerHTML = d.deposits.slice().reverse().map(r=>`<li class="p-2 border-b flex justify-between"><div>₹${r.amount} via ${r.method}</div><div class="text-sm text-sky-500">${r.status}</div></li>`).join('') || '<div class="text-gray-500">No deposit requests</div>'; } const balEl=document.getElementById('balance'); if(balEl){ const bal = d.deposits.reduce((s,x)=>s+Number(x.amount||0),0) - d.withdraws.reduce((s,x)=>s+Number(x.amount||0),0); balEl.textContent = bal.toFixed(2); } }
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
document.addEventListener('DOMContentLoaded',()=>{ renderRequests(); document.getElementById('deposit_form')?.addEventListener('submit',function(e){ e.preventDefault(); addDeposit(this.amount.value,this.method.value,this.note.value); alert('Deposit request submitted (demo)'); window.location='dashboard.html'; }); document.getElementById('withdraw_form')?.addEventListener('submit',function(e){ e.preventDefault(); addWithdraw(this.amount.value,this.name.value,this.acc.value,this.ifsc.value); alert('Withdraw request submitted (demo)'); window.location='dashboard.html'; }); });